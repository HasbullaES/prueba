var jsPlaxed=(function(){var r=0;var s="";var t=0;var u=0;var v=Array();var w="";var x=false;var y=false;var z=false;var A=document.title;var B=0;var C="";var D="";var E="";var F=function(a){if(!z){var b=confirm('Desea eliminar esta publicación?');if(b==true){z=true;R(a)}}else{alert('Debe esperar hasta que se elimine el otro elemento.')}}var G=function(a,b){if(!y){y=true;if(!x){x=true;V(a,'index.php?enviarPuntuacion','publicacion_id='+a+'&signo='+b)}else{setTimeout('puntuar('+a+','+b+')',3000)}}else{alert('Debe esperar hasta que se envíe la otra puntuación.')}};var H=function(a){a=a||'';if(a){B=a;var b=$('#p-username-'+a).html();b=b.substr(2);$('#text_mensaje').val(b+' ')}else{B=0;$('#text_mensaje').val('')}$('#div-absoluto-publicar').css('display','block');$('#div-publicar').css('display','block');$('#text_mensaje').focus();if(a){$('#text_mensaje').setCursorPosition(b.length+1)}};var I=function(){alert('aun no disponible -.-')};var J=function(){if(w==''||w=='index.php'){$('#lmore').html('<img src="images/template/loader_posts.gif">');if(!x){x=true;W()}else{setTimeout('masPlaxs()',3000)}}else{alert('Aun no disponible en este modulo...')}};var K=function(){$('#div-absoluto-publicar').css('display','none');$('#div-publicar').css('display','none');$('#divnotificaciones').css('display','none')};var L=function(){$('#div-absoluto-publicar').css('display','block');$('#divnotificaciones').css('display','block')};var M=function(){var a=B;var b=$('#text_mensaje').val();var c=200-b.length;if(c>=0&&c<200){var d=$('#respuesta_envio').val();if(d=='reposo'){$('#btn_enviar').val('Plaxeando...');$('#btn_enviar').attr('disabled','disabled');$('#text_mensaje').attr('disabled','disabled');if(!x){x=true;$('#respuesta_envio').val('enviando');b=encodeURIComponent(b);b=b.replace(/\+/g,'%2B');S('respuesta_envio','index.php?enviarPost','txt='+b+'&en_respuesta='+a+'&modulo='+w)}else{setTimeout("enviarPublicacion()",3000)}}}else{$('#text_mensaje').focus()}};var N=function(a){var b=200-a.length;var c='';if(b>=0){c='Te quedan '+b+' caracteres';$('#span_cuenta').css('color','#555')}else{c='Te excediste en '+b+' caracteres';$('#span_cuenta').css('color','#f00')}$('#span_cuenta').html(c)};var O=function(a){if(w!='p'){var b=$('#respuesta_envio').val();if(!a){a=false}if(w=='u'){T(a,'index.php?recuperarPosts','ultimoIdPublicacion='+t+'&modulo='+w+'&usuarioActual='+C)}else if(w=='c'){T(a,'index.php?recuperarPosts','PostIdBottom='+u+'&modulo='+w+'&conversacionActual='+D)}else if(w=='tema'){T(a,'index.php?recuperarPosts','ultimoIdPublicacion='+t+'&temaActual='+E+'&modulo='+w)}else{T(a,'index.php?recuperarPosts','ultimoIdPublicacion='+t+'&modulo='+w)}}};var P=function(){var d=$('#respuesta_envio').val();if(d=='reposo'){var e=document.createDocumentFragment();$.each(v,function(a,b){var c=document.createElement("div");$(c).attr('id',b.div_id);$(c).addClass('msj');$(c).html(b.contenido);if(w=='c'){$('#cl').append($(c))}else{$(c).insertBefore($('div.cl div:first'))}});$('.lnkVoto').unbind('click');$('.lnkVoto').click(function(){G($(this).attr('msjId'),$(this).attr('msjVoto'))});$('.lnkBorrar').unbind('click');$('.lnkBorrar').click(function(){F($(this).attr('msjId'))})$('.lnkResponder').unbind('click');$('.lnkResponder').click(function(){H($(this).attr('msjId'))});v=Array();document.title=A;$('#div_aviso_mensajes').html('');$('#div_aviso_mensajes').css('display','none');$('#respuesta_refrescar').val('reposo')}};var Q=function(){estadoEnvio=$('#respuesta_envio').val();r++;if(w=='not'){}else{estadoRefrescar=$('#respuesta_refrescar').val();if(!x){if(estadoEnvio!='reposo'){if(estadoEnvio=='enviado'){K();$('#text_mensaje').val('');$('#text_mensaje').removeAttr('disabled');$('#btn_enviar').val('Plaxear!');$('#btn_enviar').removeAttr('disabled');N($('#text_mensaje').val());x=true;O(true);window.clearInterval(s);r=0;s=setInterval(Q,3000)}if(estadoEnvio=='no_enviado'){$('#btn_enviar').val('Plaxear!');$('#btn_enviar').removeAttr('disabled');$('#text_mensaje').removeAttr('disabled');$('#text_mensaje').focus()}if(estadoEnvio!='enviando'&&estadoEnvio!='reposo'){$('#respuesta_envio').val('reposo')}}else{if(r==5){O(false)}}}}if(r==5){r=0}};var R=function(a){if(!x){x=true;U('div_msj_'+a,'index.php?eliminarPost','publicacion_id='+a)}else{setTimeout('borrar('+a+')',3000)}};var S=function(d,e,f){$.ajax({url:e,type:'POST',data:f,success:function(a,b,c){$('#'+d).val(a);x=false},ajaxSend:function(){$('#'+d).val('enviando')},error:function(a,b,c){alert(b)}})};var T=function(o,p,q){$.ajax({url:p,type:'POST',data:q,success:function(a,b,c){var d=a;var e=$.parseJSON(d);var f=e.posts;var g=e.notificaciones;var h=e.usuario.c_mensajes;var j=e.usuario.c_puntos;var k=e.usuario.c_notificaciones;for(i=0;i<f.length;i++){if(!$('#'+f[i].div_id).length){v.push(f[i]);if(w=='c'){u=f[i].publicacion_id}else{t=f[i].publicacion_id}}}if(o){P();x=false}else{if(f.length>0){document.title='('+v.length+') '+A;document.getElementById('respuesta_refrescar').value='pendiente';$('#div_aviso_mensajes').html('<a href="javascript:;" id="lnkMensajesPendientes"> + '+v.length+' Mensajes</a>').css('display','block');$('#lnkMensajesPendientes').click(function(){P()})}}var l=document.getElementById('ul-notificaciones');while(l.hasChildNodes()){l.removeChild(l.firstChild)}for(i=0;i<g.length;i++){var m=document.createElement("li");var n=g[i].contenido;m.innerHTML=n;if(g[i].visto=="no"){m.className="not-vista"}l.appendChild(m);$('#span_c_mensajes').html('<a href="javascript:;">'+h+' Publicaciones</a>');$('#span_c_puntos').html('<a href="javascript:;">'+j+' Puntos</a>');$('#span_c_notificaciones').html(k)}}})};var U=function(e,f,g){$.ajax({url:f,type:'POST',data:g,success:function(a,b,c){var d=a;if(d=='ok'){$('#'+e).remove()}else{alert('Ocurrió un error! No se pudo eliminar')}z=false;x=false}})};var V=function(e,f,g){$.ajax({url:f,type:'POST',data:g,success:function(a,b,c){var d=a;if(d!='error'){$('#minus_'+e).remove();$('#plus_'+e).remove();$('#msj_puntos_'+e).html(d)}else{alert('Ocurrió un error :(')}y=false;x=false}})};var W=function(){$.ajax({url:'index.php?masPlaxs',type:'POST',data:'bottomId='+u,success:function(a,b,c){var d=$.parseJSON(a);for(i=0;i<d.length;i++){var e=document.createElement("div");$(e).attr('id',d[i].div_id);$(e).addClass('msj');$(e).html(d[i].contenido);$('#cl').append($(e));u=d[i].publicacion_id}$('#lmore').html('<a href="javascript:;" onclick="masPlaxs();">Cargar mas plaxs...</a>');x=false},error:function(a,b,c){x=false}})};return{setUltimoIdPublicacion:function(a){t=a},setPostIdBottom:function(a){u=a},setModuloActual:function(a){w=a},setUsuarioActual:function(a){C=a},setConversacionActual:function(a){D=a},setTemaActual:function(a){E=a},iniciar:function(){$(':input[placeholder]').placeholder();estadoEnvio=$('#respuesta_envio').val();$('#text_mensaje').on('keypress keydown keyup',function(){N($('#text_mensaje').val())})$('#div-absoluto-publicar').on({'keydown':function(e){if(e.which==27){if(estadoEnvio!='enviando')K()}},'mousedown':function(e){if(e.which==1){if(e.target.id=='div-absoluto-publicar'&&estadoEnvio!='enviando')K()}}})$('#btn_enviar').click(function(){M()});$('#lnkAbrirNotificaciones').click(function(){L()});$('#lnkMasPlaxs').click(function(){J()});$('#lnkOcultarDivAbsoluto').click(function(){K()});$('#lnkMasNotificaciones').click(function(){I()});$('#lnkPublicarMensaje').click(function(){H()});$('.lnkVoto').click(function(){G($(this).attr('msjId'),$(this).attr('msjVoto'))});$('.lnkBorrar').click(function(){F($(this).attr('msjId'))})$('.lnkResponder').click(function(){H($(this).attr('msjId'))});s=setInterval(Q,3000);console.log('aplicacion iniciada')}}})();